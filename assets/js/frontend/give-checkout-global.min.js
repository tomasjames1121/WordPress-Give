var give_scripts,give_global_vars;jQuery(function(e){function i(){var i=e(this),a=i.parents("form");if("card_state"!=i.attr("id")){a.find("#card_state").empty().append('<option value="1">'+give_global_vars.general_loading+"</option>").prop("disabled",!0);var t={action:"give_get_states",country:i.val(),field_name:"card_state"};e.ajax({type:"POST",data:t,url:give_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(e){if("nostates"==e){var i='<input type="text" id="card_state" name="card_state" class="cart-state give-input required" value=""/>';a.find('input[name="card_state"], select[name="card_state"]').replaceWith(i)}else a.find('input[name="card_state"], select[name="card_state"]').replaceWith(e);s.trigger("give_checkout_billing_address_updated",[e,a.attr("id")])}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}return!1}function a(){give_form=e("form.give-form"),give_form.each(function(){var i=e(this).find(".card-number"),a=e(this).find(".card-cvc"),t=e(this).find(".card-expiry");return 0!==i.length&&(i.payment("formatCardNumber"),a.payment("formatCardCVC"),void t.payment("formatCardExpiry"))})}function t(e,i){return"after"==give_global_vars.currency_pos&&(i.format="%v%s"),accounting.formatMoney(e,i).trim()}function n(e){return Math.abs(parseFloat(accounting.unformat(e,give_global_vars.decimal_separator)))}function o(i){var a=[];return i.hasClass("give-form-type-multi")?(e.each(i.find(".give-donation-levels-wrap [data-price-id] "),function(e,i){i=i instanceof jQuery?i:jQuery(i),a.push({price_id:i.data("price-id"),amount:n(i.val())})}),a):a}function r(i){var a=i.parents("form"),t=i.val(),n=i.data("price-id"),o=a.find(".give-currency-symbol").text();if(i.parents(".give-donation-levels-wrap").find(".give-default-level").removeClass("give-default-level"),i.find("option").removeClass("give-default-level"),i.is("select")?i.find(":selected").addClass("give-default-level"):i.addClass("give-default-level"),a.find(".give-amount-top").removeClass("invalid-amount"),n||(n=i.find("option:selected").data("price-id")),a.find("input[name=give-price-id]").val(n),a.find(".give-amount-hidden").val(t),"custom"===t)return a.find(".give-amount-top").val("").focus(),!1;a.find(".give-amount-top").val(t),a.find("span.give-amount-top").text(t);var r=o+t;"after"==give_global_vars.currency_pos&&(r=t+o),e(".give-donation-amount .give-text-input").trigger("blur"),e(document).trigger("give_donation_value_updated",[a,t,n]),a.find(".give-final-total-amount").data("total",t).text(r)}function d(){var i=l("form-id"),a=l("payment-mode");if(!i||!a)return!1;var t=e("body").find("#give-form-"+i+"-wrap"),n=t.find("form.give-form"),o=t.hasClass("give-display-modal"),r=t.hasClass("give-display-reveal");n.find("#give-gateway-radio-list label").removeClass("give-gateway-option-selected"),n.find("input[name=payment-mode][value="+a+"]").prop("checked",!0).parent().addClass("give-gateway-option-selected"),o?e.magnificPopup.open({mainClass:"give-modal",items:{src:n,type:"inline"},callbacks:{open:function(){e(".mfp-content").outerWidth()>=500&&e(".mfp-content").addClass("give-responsive-mfp-content")},close:function(){n.removeClass("mfp-hide")}}}):r&&(n.find(".give-btn-reveal").hide(),n.find("#give-payment-mode-select, #give_purchase_form_wrap").slideDown())}function l(e,i){i||(i=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=a.exec(i);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}var s=e(document);s.on("change","#give_cc_address input.card_state, #give_cc_address select",i),a(),s.on("give_gateway_loaded",function(){a()}),e.fn.toggleError=function(e){return this.toggleClass("error",e),this.toggleClass("valid",!e),this},s.on("keyup change",".give-form .card-number, .give-form .card-cvc, .give-form .card-expiry",function(){var i=e(this),a=i.parents("form.give-form"),t=i.attr("id"),n=a.find(".card-number"),o=a.find(".card-cvc"),r=a.find(".card-expiry"),d=e.payment.cardType(n.val());if(t.indexOf("card_number")>-1){var l=a.find(".card-type");null===d?(l.removeClass().addClass("off card-type"),i.removeClass("valid").addClass("error")):l.removeClass("off").addClass(d),n.toggleError(!e.payment.validateCardNumber(n.val()))}if(t.indexOf("card_cvc")>-1&&o.toggleError(!e.payment.validateCardCVC(o.val(),d)),t.indexOf("card_expiry")>-1){r.toggleError(!e.payment.validateCardExpiry(r.payment("cardExpiryVal")));var s=r.payment("cardExpiryVal");a.find(".card-expiry-month").val(s.month),a.find(".card-expiry-year").val(s.year)}}),s.on("submit","#give_payment_mode",function(){var i=e("#give-gateway option:selected").val();if(0==i)return alert(give_global_vars.no_gateway),!1}),s.on("click","#give-payment-mode-select input",function(){e("#give-payment-mode-select label.give-gateway-option-selected").removeClass("give-gateway-option-selected"),e("#give-payment-mode-select input:checked").parent().addClass("give-gateway-option-selected")}),s.on("focus",".give-donation-amount .give-text-input",function(i){var a=e(this).parents("form");e(this).removeClass("invalid-amount");var t=a.find(".give-final-total-amount").data("total");e(this).data("amount",n(t)),e(this).parent(".give-donation-amount").addClass("give-custom-amount-focus-in"),a.find(".give-default-level, .give-radio-input").removeClass("give-default-level"),a.find(".give-btn-level-custom").addClass("give-default-level"),a.find(".give-radio-input").prop("checked",!1),a.find(".give-radio-input.give-radio-level-custom").prop("checked",!0),a.find(".give-select-level").prop("selected",!1),a.find(".give-select-level .give-donation-level-custom").prop("selected",!0)}),s.on("blur",".give-donation-amount .give-text-input",function(i){var a=e(this).closest("form"),r=e(this).data("amount"),d=e(this).val(),l=a.find('input[name="give-form-minimum"]'),s=n(l.val()),v=0==d?s:n(d),c=o(e(this).parents("form")),g={symbol:"",decimal:give_global_vars.decimal_separator,thousand:give_global_vars.thousands_separator,precision:give_global_vars.number_decimals},u=t(v,g);e(this).val(u);var m=-1;if(c.length&&(e.each(c,function(e,i){if(i.amount===v)return m=i.price_id,!1}),!(-1<m)&&s<v&&(m="custom")),(v<s||v<1)&&!m&&0!==s){e(this).addClass("give-invalid-amount"),g.symbol=give_global_vars.currency_sign,l=give_global_vars.bad_minimum+" "+t(s,g),a.find(".give-submit").prop("disabled",!0);var p=a.find(".give-invalid-minimum");if(0===p.length){var f=e('<div class="give_error give-invalid-minimum">'+l+"</div>").hide();f.insertBefore(a.find(".give-total-wrap")).show()}}else a.find(".give-invalid-minimum").slideUp(300,function(){e(this).remove()}),a.find(".give-submit").prop("disabled",!1);r!==v&&(g.symbol=give_global_vars.currency_sign,a.find(".give-final-total-amount").data("total",v).text(t(v,g))),c.length&&(-1!==m&&e('input[name="give-price-id"]',a).val(m),a.find(".give-radio-input").length&&(a.find(".give-radio-input").prop("checked",!1),a.find('.give-radio-input[data-price-id="'+m+'"]').prop("checked",!0))),e(this).parent(".give-donation-amount").removeClass("give-custom-amount-focus-in")}),s.on("keyup",".give-donation-amount .give-text-input",function(i){var a=e(this).parents("form"),t=o(e(this).parents("form")),r=n(e(this).val()),d=-1,l=n(a.find('input[name="give-form-minimum"]'));return!!t.length&&(e.each(t,function(e,i){i.amount===r&&(d=i.price_id)}),void(-1<d?e('input[name="give-price-id"]',a).val(d):l<r&&e('input[name="give-price-id"]',a).val("custom")))}),s.on("click touchend",".give-donation-level-btn",function(i){i.preventDefault(),r(e(this))}),s.on("click touchend",".give-radio-input-level",function(i){r(e(this))}),s.on("change",".give-select-level",function(i){r(e(this))}),d()});