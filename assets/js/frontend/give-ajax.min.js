/*!
 * Give AJAX JS
 *
 * @description: The Give AJAX scripts
 * @package:     Give
 * @subpackage:  Assets/JS
 * @copyright:   Copyright (c) 2015, WordImpress
 * @license:     http://opensource.org/licenses/gpl-2.0.php GNU Public License
 */
/**
 * Load the Payment Gateways
 *
 * @description: AJAX load appropriate gateway fields
 * @param form_object Obj The specific form to load a gateway for
 * @param payment_mode
 */
function give_load_gateway(e,i){var t=jQuery(e).find("#give-payment-mode-select .give-loading-text"),a=jQuery(e).find("#give-amount").val(),o=jQuery(e).find('input[name="give-form-id"]').val();
// Show the ajax loader
t.fadeIn();
//Update form action
//give_form.attr( 'action', '?payment-mode=' + payment_mode );
var n=jQuery(e).data();1!=n["blockUI.isBlocked"]&&jQuery(e).find("#give_purchase_form_wrap").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),
//Post via AJAX to Give
jQuery.post(give_scripts.ajaxurl+"?payment-mode="+i,{action:"give_load_gateway",give_total:a,give_form_id:o,give_payment_mode:i},function(i){
//Success: let's output the gateway fields in the appropriate form space
jQuery(e).unblock(),jQuery(e).find("#give_purchase_form_wrap").html(i),jQuery(".give-no-js").hide(),jQuery(e).find("#give-payment-mode-wrap .give-loading-text").fadeOut(),setup_give_tooltips(),
// trigger an event on success for hooks
jQuery(document).trigger("give_gateway_loaded",[i])})}/**
 * Load Tooltips
 *
 * @description Give tooltips use qTip2
 * @since 1.0
 */
function setup_give_tooltips(){jQuery('[data-tooltip!=""]').qtip({// Grab all elements with a non-blank data-tooltip attr.
content:{attr:"data-tooltip"},style:{classes:"qtip-rounded qtip-tipsy"},position:{my:"bottom center",// Position my top left...
at:"top center"}})}var give_scripts,give_global_vars;jQuery(document).ready(function(e){
//Run tooltips setup
setup_give_tooltips(),
//Hide loading elements
e(".give-loading-text").hide(),
// Show the login form in the checkout when the user clicks the "Login" link
e("body").on("click",".give_checkout_register_login",function(i){var t=e(this),a={action:t.data("action")},o=e(this).parents("form"),n=e(o).find("#give-login-account-wrap .give-loading-text");
// Show the ajax loader
return n.show(),e.post(give_scripts.ajaxurl,a,function(i){e(o).find("#give_checkout_login_register").html("").html(i)}).done(function(){setup_form_loading_images(),
// Hide the ajax loader
n.hide()}),!1}),
// Process the login form via ajax when the user clicks "login"
e(document).on("click","#give_login_fields input[type=submit]",function(i){i.preventDefault();var t=e(this).val(),a=e(this).parents("form");e(this).val(give_global_vars.purchase_loading),a.find("#give_login_fields .give-loading-animation").fadeIn();var o={action:"give_process_checkout_login",give_ajax:1,give_user_login:a.find("#give_user_login").val(),give_user_pass:a.find("#give_user_pass").val()};e.post(give_global_vars.ajaxurl,o,function(i){
//user is logged in
"success"==e.trim(i)?(
//remove errors
a.find(".give_errors").remove(),
//reload the selected gateway so it contains their logged in information
give_load_gateway(a,a.find(".give-gateway-option-selected input").val())):(
//Login failed, show errors
a.find("#give_login_fields input[type=submit]").val(t),a.find(".give-loading-animation").fadeOut(),a.find(".give_errors").remove(),a.find("#give-user-login-submit").before(i))})}),
//Switch the gateway on gateway selection field change
e("select#give-gateway, input.give-gateway").on("change",function(i){i.preventDefault();
//Which payment gateway to load?
var t=e(this).val();
//Problema? Bounce
//Problema? Bounce
return"0"==t?(console.log("There was a problem loading the selected gateway"),!1):(give_load_gateway(e(this).parents("form"),t),!1)}),
//Process the donation submit
e("body").on("click touchend","#give-purchase-button",function(i){
//this form object
var t=e(this).parents("form.give-form"),a=t.find("#give_purchase_submit .give-loading-animation");a.fadeIn();
//this form selector
var o=t.get(0);
//check validity
if("function"==typeof o.checkValidity&&o.checkValidity()===!1)//Don't leave any handing loading animations
return void a.fadeOut();
//prevent form from submitting normally
i.preventDefault();
//Submit btn text
var n=e(this).val();
//Update submit button text
e(this).val(give_global_vars.purchase_loading),
//Submit form via AJAX
e.post(give_global_vars.ajaxurl,t.serialize()+"&action=give_process_checkout&give_ajax=true",function(i){"success"==e.trim(i)?(
//Remove any errors
t.find(".give_errors").remove(),
//Submit form for normal processing
e(o).submit()):(t.find("#give-purchase-button").val(n),a.fadeOut(),t.find(".give_errors").remove(),t.find("#give_purchase_submit").before(i))})})});